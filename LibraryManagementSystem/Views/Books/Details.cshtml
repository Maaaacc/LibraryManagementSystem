@model Book
@{
    ViewData["Title"] = "Book Details";
    var activeBorrowCount = ViewBag.ActiveBorrowCount ?? 0;
    // Assume loanPeriodDays is a constant or from configuration - put 30 days here as example
    int loanPeriodDays = 30;
}

<a asp-action="Index" class="btn btn-link mb-3">&larr; Back to Browse</a>

<div class="row">
    <div class="col-md-4 text-center">
        @if (!string.IsNullOrEmpty(Model.CoverImagePath))
        {
            <img src="@Model.CoverImagePath" alt="@Model.Title" class="img-fluid rounded shadow-sm" style="max-height: 350px; object-fit: contain;" />
        }
        else
        {
            <div class="bg-light d-flex align-items-center justify-content-center" style="height: 350px;">
                <span class="text-muted">No Cover Image</span>
            </div>
        }
    </div>
    <div class="col-md-8">
        <h1>@Model.Title</h1>
        <p class="lead">by <em>@Model.Author</em></p>
        <p>
            <strong>Status: </strong>
            @if (Model.AvailableCopies > 0)
            {
                <span class="text-success">Available</span>
            }
            else
            {
                <span class="text-danger">Unavailable</span>
            }
        </p>

        <h5>Book Details</h5>
        <dl class="row">
            <dt class="col-sm-4">Category</dt>
            <dd class="col-sm-8">@Model.Category</dd>

            <dt class="col-sm-4">ISBN</dt>
            <dd class="col-sm-8">@Model.ISBN</dd>

            <dt class="col-sm-4">Available Copies</dt>
            <dd class="col-sm-8">@Model.AvailableCopies/@Model.TotalCopies</dd>

            <dt class="col-sm-4">Loan Period</dt>
            <dd class="col-sm-8">@loanPeriodDays days</dd>
        </dl>

        @if (!string.IsNullOrEmpty(Model.Description))
        {
            <h5>Description</h5>
            <p>@Model.Description</p>
        }

        <div class="mt-4">
            <p>You currently have @activeBorrowCount/3 borrows.</p>
            @if (Model.AvailableCopies > 0)
            {
                if (activeBorrowCount >= 3)
                {
                    <button class="btn btn-warning" disabled>Limit Reached</button>
                }
                else
                {
                    <form asp-controller="Borrows" asp-action="Borrow" method="post">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="bookId" value="@Model.Id" />
                        <button type="submit" class="btn btn-success">Borrow this Book</button>
                    </form>
                }
            }
            else
            {
                <button class="btn btn-secondary" disabled>No Copies Available</button>
            }
            <p class="mt-2"><small>You must return this after @loanPeriodDays days.</small></p>
        </div>
    </div>
</div>
